# =============================================================================
# multi-agent-shogun Makefile
# =============================================================================
# マルチエージェント並列開発基盤の操作コマンド集
# =============================================================================

.PHONY: help setup start start-setup stop status attach-shogun attach-agents

# デフォルトターゲット: ヘルプを表示
.DEFAULT_GOAL := help

# -----------------------------------------------------------------------------
# setup: 初回セットアップ
# -----------------------------------------------------------------------------
# first_setup.sh を実行し、必要な設定を行う
setup:
	@./first_setup.sh

# -----------------------------------------------------------------------------
# start: 出陣（全エージェント起動）
# -----------------------------------------------------------------------------
# shutsujin_departure.sh を実行し、将軍・家老・足軽を起動
shutsujin:
	@./shutsujin_departure.sh

# -----------------------------------------------------------------------------
# start-setup: セットアップのみ（Claude起動なし）
# -----------------------------------------------------------------------------
# tmuxセッションの準備のみ行い、Claudeは起動しない
start-setup:
	@./shutsujin_departure.sh -s

# -----------------------------------------------------------------------------
# stop: 全セッション終了
# -----------------------------------------------------------------------------
# shogun と multiagent セッションを終了
stop:
	@tmux kill-session -t shogun 2>/dev/null || true
	@tmux kill-session -t multiagent 2>/dev/null || true
	@echo "全セッションを終了いたした"

# -----------------------------------------------------------------------------
# status: セッション状態確認
# -----------------------------------------------------------------------------
# 現在のtmuxセッション一覧を表示
status:
	@tmux list-sessions 2>/dev/null || echo "起動中のセッションはござらぬ"

# -----------------------------------------------------------------------------
# attach-shogun: 将軍セッションにアタッチ
# -----------------------------------------------------------------------------
# shogun セッション（将軍ペイン）に接続する
attach-shogun:
	@tmux attach -t shogun

# -----------------------------------------------------------------------------
# attach-multiagent: 家老・足軽セッションにアタッチ
# -----------------------------------------------------------------------------
# multiagent セッション（家老・足軽ペイン）に接続する
attach-agents:
	@tmux attach -t multiagent

# -----------------------------------------------------------------------------
# help: ヘルプ表示
# -----------------------------------------------------------------------------
# 各ターゲットの説明を表示
help:
	@echo "=============================================="
	@echo " multi-agent-shogun コマンド一覧"
	@echo "=============================================="
	@echo ""
	@echo "  make setup             : 初回セットアップを実行"
	@echo "  make shutsujin         : 出陣（全エージェント起動）"
	@echo "  make start-setup       : セットアップのみ（Claude起動なし）"
	@echo "  make stop              : 全セッション終了"
	@echo "  make status            : セッション状態確認"
	@echo "  make attach-shogun     : 将軍セッションにアタッチ"
	@echo "  make attach-agents     : 家老・足軽セッションにアタッチ"
	@echo "  make help              : このヘルプを表示"
	@echo ""
